# 浜松市向けデータ戦略（ひなんけいろ）

**対象地域**: 静岡県浜松市を中心とした住民避難  
**目的**: 位置情報・標高・建築物の高さと個人の運動能力を組み合わせ、**制限時間内に到達可能な最も高い場所**へ避難するシミュレーションを実現する。

---

## 1. 必要なデータと役割

| データ | 役割 | 利用イメージ |
|--------|------|----------------|
| **位置情報** | 現在地・避難経路・候補地点の特定 | 経路計算・「到達可能範囲」の可視化 |
| **標高（地形）** | 地面の高さ（m） | 浸水想定との比較・平地での避難高さ |
| **建築物の高さ** | 建物の高さ（m） | 建物屋上等の「有効避難高さ」= 標高 + 建物高さ |
| **個人の運動能力** | 歩行速度・制限時間内の到達距離 | 訓練ログから算出（`UserMobilityProfile` / `EmergencyGuideProfile`） |

**有効避難高さ** = その地点で津波から身を守れる高さ。  
- 平地: 地形の**標高**  
- 建物上: 地形の**標高** + **建築物の高さ**

**訓練時の流れ**: 制限時間内に「どこまで行けるか」をユーザーの運動能力から算出し、その範囲内で**有効避難高さが高い場所**を**複数**候補として提示。ユーザーが**自ら1つを選んで**それを目標地とし、訓練を開始する（型: `EvacuationOptionForChoice`、`shared/types.ts`）。

**標高データ**: 国土地理院のデータでよい（標高API・標高タイル）。

---

## 2. データソース（静岡県・浜松市）

浜松市は**建物の位置情報・高さ・広さ**を Project PLATEAU で、**避難施設の収容人数**等を PLATEAU 関連データや静岡県オープンデータで公開している。以下に整理する。

### 2.1 建築物の位置・高さ・広さ（形状）

- **Project PLATEAU 浜松市（2023年度）**
  - データセット: [G空間情報センター plateau-22130-hamamatsu-shi-2023](https://www.geospatial.jp/ckan/dataset/plateau-22130-hamamatsu-shi-2023)
  - 形式: CityGML（LOD0/1/2）、3D Tiles、MVT
  - **位置**: 建築物ポリゴン（平面形状）で提供。
  - **高さ**: 3D モデルから算出可能。PLATEAU 標準では「計測高さ」を提供する市区町村もある（地域により属性の有無あり）。
  - **広さ**: 標準製品仕様書では「延床面積」「建築面積」「図上面積」等を地域により提供。CityGML のジオメトリから図上面積は算出可能。
  - 静岡県は高精度測位（VIRTUAL SHIZUOKA）を使用しておりデータ容量に注意。
- **浜松市オープンデータカタログ**: [オープンデータカタログ／浜松市](https://www.city.hamamatsu.shizuoka.jp/odpf/opendata/v1.html)
- **データ連携基盤**: [浜松市データプラットフォームポータル](https://dataplatformportal.city.hamamatsu.shizuoka.jp/)（デジタル・スマートシティ浜松）

**取り込み方針**: Agent E がスクリプトで PLATEAU を取得し、アプリで扱いやすい形式（例: GeoJSON の建物ポリゴン + `height` / `area` 属性）に変換して `data/` に配置。範囲は浜松市中心に必要なタイルのみに絞る。

### 2.1.1 収容人数（避難施設・建物）

- **PLATEAU 浜松市 関連データ（v4）**
  - 同一データセット内の「[関連データセット（v4）](https://www.geospatial.jp/ckan/dataset/plateau-22130-hamamatsu-shi-2023/resource/8fa49659-a4e6-46de-8281-11afb82c53f4)」に **避難施設情報（GeoJSON）** が含まれる。避難所・避難施設の位置・属性（収容人数が含まれる場合あり）を利用可能。
- **静岡県オープンデータ**
  - [静岡県オープンデータポータル](https://opendata.pref.shizuoka.jp/) で「指定緊急避難場所」「避難所」等のデータセットを公開。他市では収容人数が記載されたデータあり。
  - [浜松市施設情報](https://opendata.pref.shizuoka.jp/dataset/11615.html): 協働センター・図書館・文化施設等の施設情報（XLSX/CSV）。
- **防災オープンデータマップ（浜松市）**: [防災オープンデータマップ](https://www.city.hamamatsu.shizuoka.jp/dsc/sakutei/digital_smartcity/hdg/bosai.html) で AED・緊急避難場所等を地図可視化。元データの取得方法はポータル・カタログで確認。

建物単位の「収容人数」を浜松市が一括公開している場合は、上記オープンデータカタログまたはデータプラットフォームでデータセットを確認し、`data/hamamatsu/` に取り込む。

### 2.2 標高（地形）※国土地理院のデータでOK

- **国土地理院 標高 API（取得ポイント）**
  - 指定した緯度・経度の標高を取得可能。
  - 例: `https://cyberjapandata2.gsi.go.jp/general/dem/scripts/getelevation.php?lat=34.7&lon=137.7&outtype=JSON`
  - レスポンス: `elevation`（標高値）、`hsrc`（5m レーザ/写真測量、10m 等）。過度なアクセスは避ける。
- **標高タイル**: 基盤地図情報数値標高モデル（DEM）をタイルで取得し、クライアントまたはサーバで標高を算出する方法もある。

**利用方針**: 標高は国土地理院に統一。経路沿い・避難候補地点の標高は Agent A が API または標高タイルで取得。建築物の「地面の標高」も同じソースで揃える。

### 2.3 津波浸水想定・避難所

- 内閣府・静岡県の津波浸水想定区域（Shape/GeoJSON）
- 避難所: 内閣府防災情報・浜松市オープンデータ等

既存の ARCHITECTURE 想定のまま。必要に応じて `scripts/` で取得・GeoJSON 化する。

### 2.4 津波避難ビル（浜松市公式）

津波時に「建物の高い所へ逃げる」候補として、市が協定を結んだ**津波避難ビル**の一覧を浜松市が公式に公開している。

- **公式ページ**: [津波避難ビルの指定について／浜松市](https://www.city.hamamatsu.shizuoka.jp/kiki/disaster/bousai/building/index.html)
- **指定基準**: 鉄筋コンクリートまたは鉄骨鉄筋コンクリート、3階建以上、昭和56年6月以降の新耐震基準。
- **提供形式**:
  - 一覧表（施設名称・棟名・住所・避難場所）がページ内に掲載。
  - **PDF一覧**（約115KB）がダウンロード可能。
  - **浜松市防災マップ**: 「個別情報」→ レイヤー「緊急避難場所（津波）」で地図上に表示。施設ごとに「地図」クリックで位置確認可能。

**ひなんけいろでの利用**: 津波シナリオ時の避難目標候補として、津波避難ビル・津波避難タワー・津波避難マウンドを優先的に候補に含める。一覧データは PDF または防災マップの元データから取得し、住所をジオコーディングして `data/hamamatsu/tsunami-evacuation-buildings.geojson` 等に格納する（Agent E）。地図表示・経路計算は Agent A がこのデータを参照する。

---

## 3. 他エージェントとの役割分担

- **Agent A（地図・シミュレーション）**
  - 建築物レイヤー（高さ付き）の表示、経路と「制限時間内の到達可能範囲」の計算。
  - 範囲内の各候補（地形の点・建物）の有効避難高さを比較し、「最も高い場所」の候補を提示。
- **Agent B（API・ログ）**
  - 個人の運動能力は訓練ログから算出（`UserMobilityProfile` / `EmergencyGuideProfile`）。データ取り込みの対象外。
- **Agent E（インフラ・データ取り込み）**
  - PLATEAU の取得・変換、標高データの取得方法の整備、`data/` の配置と `README` の環境構築・データ取得手順の記載。

---

## 4. データ配置（案）

```
data/
├── hamamatsu/
│   ├── buildings.geojson              # 建築物ポリゴン + height, area（PLATEAU から変換）
│   ├── inundation.geojson             # 津波浸水想定（必要に応じて）
│   ├── shelters.geojson               # 避難所・避難施設（PLATEAU 関連データ等、収容人数含む場合あり）
│   └── tsunami-evacuation-buildings.geojson  # 津波避難ビル・タワー・マウンド（市公式一覧から取得）
├── elevation/                # 標高は API またはタイルで取得するため、静的ファイルはオプション
└── README.md                 # データの出典・利用条件・更新手順
```

---

## 5. 利用条件・注意

- **PLATEAU**: 商用利用含め無償。利用規約・クレジット表記に従う。
- **国土地理院**: 利用規約に従い、標高 API への過度なリクエストを避ける。
- 浜松市・静岡県のオープンデータは各ポータルの利用条件に従う。

---

このドキュメントは Agent E が作成・更新する。設計の変更は `docs/ARCHITECTURE.md` と `shared/types.ts` と整合させる。
