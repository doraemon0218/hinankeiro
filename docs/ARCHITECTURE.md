# ひなんけいろ（津波避難訓練アプリ）アーキテクチャ

## 1. ビジョン

- **対象**: 日本の沿岸部（**当面は静岡県浜松市**の住民避難を中心に展開）
- **目的**: 平時に実在の建築物・地図を使った津波避難訓練シミュレーション
- **避難の目標**: 位置情報・標高・建築物の高さと個人の運動能力を組み合わせ、**制限時間内に到達可能な最も高い場所**へ避難するシミュレーションを提供する（津波から身を守れる「有効避難高さ」の最大化）。訓練時には、**運動能力的に避難可能性の高い場所を複数提示**し、**ユーザーが自ら1つを選んで**目標地とする。
- **行政連携**: 住民の運動ログを行政と共有し、科学的な防災設計に活用
- **住民インセンティブ**: データ提供の見返り・健康効果で継続的な訓練参加を促す

## 2. 主要機能

| 領域 | 機能 | 説明 |
|------|------|------|
| 地図・シミュレーション | 実地図表示 | 実在の建築物・道路・津波浸水想定を表示 |
| | 避難経路シミュレーション | 現在地→避難所までの経路・所要時間をシミュレート |
| | 津波到達時間・浸水想定 | 想定シナリオに基づくタイムリミット表示 |
| ログ・データ共有 | 訓練ログ記録 | 経路・歩行距離・所要時間・タイムスタンプを記録 |
| | 行政向けエクスポート | 匿名化/集計されたデータを行政が取得できる形式で提供 |
| 行政・科学的デザイン | 訓練インセンティブ | 地域・年齢層・性別・期間でターゲットを設定し、振興券等で訓練を促進 |
| インセンティブ・健康 | ゲーミフィケーション | バッジ・ランク・達成率で継続を促進 |
| | 健康指標 | 歩数・距離・心拍（オプション）と訓練の紐付け |

## 3. システム構成（案）

```
[住民アプリ] ←→ [API / バックエンド] ←→ [行政向けダッシュボード/API]
     │                    │
     │                    ├── ユーザー・訓練ログDB
     │                    ├── 地図・建築物・浸水想定データ（キャッシュ/静的）
     │                    └── 集計・エクスポート
     │
     └── 地図タイル・建築物データ（国/自治体オープンデータ or マップAPI）
```

## 4. データソース（想定）

- **地図**: 国土地理院タイル、OpenStreetMap、自治体提供タイル
- **建築物（高さ含む）**: 静岡県内のデータを利活用。**Project PLATEAU 浜松市**（建築物モデル LOD0/1/2）、国土数値情報、自治体の建物データ、OSM（詳細は **docs/DATA_HAMAMATSU.md**）
- **標高**: 国土地理院の標高API・標高タイル（数値標高モデル）
- **津波浸水想定**: 内閣府・都道府県の津波浸水想定区域（Shape/GeoJSON）
- **避難所**: 内閣府防災情報、自治体オープンデータ

## 5. 地図・シミュレーションの詳細設計

地図表示・避難経路シミュレーション・レイヤー構成・コンポーネント分割は **`docs/DESIGN_MAP_SIMULATION.md`** を参照（Agent A 担当）。

## 6. 非機能要件

- オフラインでも経路表示・簡易シミュレーションが可能であると理想的
- 個人情報は最小限にし、行政共有時は匿名化・集計を前提
- モバイルファースト（住民はスマホで訓練）
- **住民UX**: 若年〜高齢者まで、高齢者でも自分のスマホで簡単に操作できることを最優先（詳細は **`docs/DESIGN_RESIDENT_UX.md`**）

## 7. 住民向けUX・有事時の方針

- **平時**: 楽しくなるインセンティブ（バッジ・ランク・ポイント）、行政への貢献の見える化、自分メリット（健康・有事時のガイド）、励ましでトレーニングを促進。
- **有事でスマホあり**: 過去の訓練ログに基づき、その人の歩行速度・よく使う経路に合わせて避難をガイド（型: `EmergencyGuideProfile`。Agent A/B と連携）。
- **有事でスマホなし**: 同じ経路を繰り返し訓練する設計により「体で覚えている」状態を目指す（「いつもの道」バッジ等で反復を促進）。

---

## 8. 関連ドキュメント

- **開発環境の構築**: `docs/SETUP.md`（初回セットアップ・トラブルシュート）
- **現場統合メモ**: `docs/FIELD_INTEGRATION.md`（各 Agent との議論内容・現状サマリ・契約の確認）
- **設計図・計画の全体**: `docs/PROJECT_PLAN.md`（目的・機能・技術・ディレクトリ・各 Agent 役割の詳細）
- **タスク分解・着手指示**: `docs/TODO.md`
- **統括Agent の役割**: `docs/ORCHESTRATOR.md`

このドキュメントは複数エージェントで参照し、一貫した設計で開発するために使用する。
