# 複数エージェント並行開発ガイド（ひなんけいろ）

このプロジェクトは **複数の Cursor Agent** を同時に使い、役割分担して効率よく開発するための分割案です。

## 前提

- リポジトリルート: `hinankeiro/`
- 設計の詳細: `docs/ARCHITECTURE.md` を参照
- 各エージェントは「自分の担当」だけを編集し、他担当のインターフェース（API・型・ファイル名）は尊重する

---

## エージェント役割とタスク分割

### Agent A: 地図・シミュレーション基盤（フロント中心）

**担当ディレクトリ**: `frontend/` の地図関連、`lib/map/`, `lib/simulation/`

**タスク例**:
- 地図ライブラリの選定と初期化（Leaflet / Mapbox / 国土地理院タイル）
- 津波浸水想定レイヤー・避難所ピンの表示
- 「現在地 → 避難所」の経路描画（ルーティングAPI or クライアント側経路）
- 津波到達時間を考慮した「タイムリミット」の可視化（例: カウントダウン・到達円）
- 建築物データのオーバーレイ表示（ポリゴン/フットプリント）

**成果物**:
- 地図コンポーネント、シミュレーション用の状態管理（経路・時間・スコア）
- 他エージェントが使う型: `SimulationState`, `RouteResult`, `EvacuationScenario`

---

### Agent B: 訓練ログ・API・バックエンド

**担当ディレクトリ**: `backend/` または `api/`, `lib/db/`, `lib/logs/`

**タスク例**:
- 訓練1回あたりのログスキーマ設計（経路GeoJSON、所要時間、距離、ユーザーID、匿名ID）
- ログ保存API（POST /api/training-logs）
- 取得API（GET /api/training-logs、行政向けは集計・匿名化）
- 行政向けエクスポート（CSV/GeoJSON、期間・地域フィルタ）
- 認証・認可の設計（住民 vs 行政、APIキー or JWT）

**成果物**:
- REST or tRPC のエンドポイント、DB マイグレーション
- 他エージェントが使う型: `TrainingLog`, `TrainingLogCreate`, `ExportOptions`

---

### Agent C: 住民向けUI・インセンティブ・健康

**担当ディレクトリ**: `frontend/` の画面・コンポーネント（地図以外）、`lib/gamification/`, `lib/health/`

**タスク例**:
- トップ画面・訓練開始/終了フロー・履歴一覧
- ゲーミフィケーション: バッジ、ランク、週間/月間達成率、ポイント
- 健康指標: 歩数・距離の表示、訓練と連携した「歩いた距離」の可視化
- 行政へのデータ提供同意フロー・説明文
- プライバシー設定（匿名で共有するか等）

**成果物**:
- 画面コンポーネント、バッジ/ランクの定義、同意モーダル
- 他エージェントが使う: `UserProfile`, `Badge`, `ConsentStatus`

---

### Agent D: 行政向けダッシュボード・可視化

**担当ディレクトリ**: `admin/` または `dashboard/`, `lib/analytics/`

**タスク例**:
- ログイン（行政担当者用）
- 集計ダッシュボード: 地域別・期間別の訓練回数、経路のヒートマップ、平均所要時間
- データエクスポート画面（CSV/GeoJSON ダウンロード）
- 防災設計に役立つ指標: 避難所までの平均時間、遅い経路の検出、ボトルネック候補

**成果物**:
- ダッシュボードページ、グラフ・地図の可視化、エクスポートAPIの呼び出し
- 他エージェントが使う: `AdminAuth`, `AggregatedStats`, `ExportFormat`

---

### Agent E: インフラ・CI・デプロイ・データ取り込み

**担当ディレクトリ**: `scripts/`, `data/`, `.github/`, 設定ファイル

**タスク例**:
- 津波浸水想定・避難所データの取得スクリプト（国・自治体オープンデータ）
- 建築物データの取り込み（GeoJSON/Shape の変換・簡略化）
- CI（lint / test / build）、デプロイ（Vercel / Cloud Run / GitHub Pages 等）
- 環境変数・シークレットのドキュメント（.env.example）

**成果物**:
- データパイプライン、デプロイ手順、`README` の環境構築セクション更新

---

## 並行して進める際のルール

1. **型・APIは `shared/` または `lib/types/` に集約**  
   各エージェントが型を追加するときはここに定義し、他は参照するだけにする。
2. **コンフリクトを減らす**  
   同時に触るファイルはなるべく分ける（Agent A は `map/`, Agent B は `api/`, Agent C は `pages/` など）。
3. **インターフェースを先に決める**  
   例: 「訓練ログを保存するAPI」のリクエスト/レスポンス型を `shared/` に書いてから、Agent B が実装、Agent A/C が呼び出す。
4. **定期的に `docs/ARCHITECTURE.md` を参照**  
   大きな仕様変更は ARCHITECTURE に追記し、全エージェントで認識を揃える。

---

## 推奨: 最初にやること（任意の1エージェント or 人間）

- モノレポ or フロント/API 分離のディレクトリ構成を決定
- `shared/` または `lib/types/` に共通型のスケルトンを追加
- この `AGENTS.md` を各エージェントに渡し、「自分は Agent B」のように役割を割り当てて開始

これで複数エージェントが同時進行で効率よく避難経路アプリを開発できます。
